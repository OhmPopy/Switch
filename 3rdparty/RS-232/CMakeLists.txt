cmake_minimum_required(VERSION 3.2)

project(RS232)

if(NOT CMAKE_DEBUG_POSTFIX)
  set(CMAKE_DEBUG_POSTFIX d)
endif()

add_library(RS232 STATIC rs232.h rs232.c) 
target_include_directories(RS232 PUBLIC $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/..> $<INSTALL_INTERFACE:include>)
add_custom_command(TARGET RS232 POST_BUILD COMMAND ${CMAKE_COMMAND} -E copy $<TARGET_FILE:RS232> ${CMAKE_HOME_DIRECTORY}/../lib/$<TARGET_FILE_NAME:RS232>)

install(EXPORT RS232 DESTINATION cmake)
install(FILES RS232Config.cmake DESTINATION cmake)
install (FILES rs232.h DESTINATION include/Rs232)
install(TARGETS RS232 EXPORT RS232 DESTINATION lib)
if(MSVC)
  target_compile_options(RS232 PRIVATE "$<$<CONFIG:Debug>:/Fd$<TARGET_FILE_DIR:RS232>/RS232${CMAKE_DEBUG_POSTFIX}.pdb>")
  target_compile_options(RS232 PRIVATE "$<$<CONFIG:Release>:/Fd$<TARGET_FILE_DIR:RS232>/RS232.pdb>")
  install(FILES "$<TARGET_FILE_DIR:RS232>/RS232${CMAKE_DEBUG_POSTFIX}.pdb" DESTINATION lib CONFIGURATIONS Debug OPTIONAL)
  install(FILES "$<TARGET_FILE_DIR:RS232>/RS232.pdb" DESTINATION lib CONFIGURATIONS Release OPTIONAL)
endif()
